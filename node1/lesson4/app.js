var eventproxy=require("eventproxy");var superagent=require("superagent");var cheerio=require("cheerio");var url=require("url");var cnodeUrl="https://cnodejs.org/";superagent.get(cnodeUrl).end(function(e,r){if(e){return console.error(e)}var t=[];var o=cheerio.load(r.text);o("#topic_list .topic_title").each(function(e,r){var n=o(r);var c=url.resolve(cnodeUrl,n.attr("href"));t.push(c)});var n=new eventproxy;n.after("topic_html",t.length,function(e){e=e.map(function(e){var r=e[0];var t=e[1];var o=cheerio.load(t);return{title:o(".topic_full_title").text().trim(),href:r,comment1:o(".reply_content").eq(0).text().trim()}});console.log("final:");console.log(e)});t.forEach(function(e){superagent.get(e).end(function(r,t){console.log("fetch "+e+" successful");n.emit("topic_html",[e,t.text])})})});