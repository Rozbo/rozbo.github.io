<!-- build time:2016-06-04 16:58:28 --><!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.lug.ustc.edu.cn//css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/static/css/main.css?v=1.0.1" rel="stylesheet" type="text/css"><meta name="keywords" content="落月博客,落月,落月助手,落月切牌器,落月官方网站"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.0.1"><meta name="description" content="《线上部署：heroku》目标将 https://github.com/Ricardo-Li/node-practice-2 (这个项目已经被删了。参照 https://github.com/alsotang/node-lessons/tree/master/lesson3 的代码自己操作一下吧。)这个项目部署上 heroku，成为一个线上项目我部署的在这里 http://serene-falls"><meta property="og:type" content="website"><meta property="og:title" content="落月官方网站"><meta property="og:url" content="http://post.zz173.com/node1/lesson12/README.html"><meta property="og:site_name" content="落月官方网站"><meta property="og:description" content="《线上部署：heroku》目标将 https://github.com/Ricardo-Li/node-practice-2 (这个项目已经被删了。参照 https://github.com/alsotang/node-lessons/tree/master/lesson3 的代码自己操作一下吧。)这个项目部署上 heroku，成为一个线上项目我部署的在这里 http://serene-falls"><meta property="og:image" content="https://github.com/alsotang/node-lessons/blob/master/lesson12/1.png"><meta property="og:image" content="https://github.com/alsotang/node-lessons/blob/master/lesson12/2.png"><meta property="og:image" content="https://github.com/alsotang/node-lessons/blob/master/lesson12/3.png"><meta property="og:image" content="https://github.com/alsotang/node-lessons/blob/master/lesson12/4.png"><meta property="og:updated_time" content="2016-04-26T14:20:42.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="落月官方网站"><meta name="twitter:description" content="《线上部署：heroku》目标将 https://github.com/Ricardo-Li/node-practice-2 (这个项目已经被删了。参照 https://github.com/alsotang/node-lessons/tree/master/lesson3 的代码自己操作一下吧。)这个项目部署上 heroku，成为一个线上项目我部署的在这里 http://serene-falls"><meta name="twitter:image" content="https://github.com/alsotang/node-lessons/blob/master/lesson12/1.png"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:void 0,author:"博主"}}</script><title>| 落月官方网站</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container one-collumn sidebar-position-left"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">落月官方网站</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">落月博客post.zz173.com</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-books"><a href="/books.html" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i><br>书</a></li><li class="menu-item menu-item-tools"><a href="/tools.html" rel="section"><i class="menu-item-icon fa fa-fw fa-wrench"></i><br>工具</a></li><li class="menu-item menu-item-blog"><a href="/post" rel="section"><i class="menu-item-icon fa fa-fw fa-pencil-square-o"></i><br>博客</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><h1 id="《线上部署：heroku》"><a href="#《线上部署：heroku》" class="headerlink" title="《线上部署：heroku》"></a>《线上部署：heroku》</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>将 <a href="https://github.com/Ricardo-Li/node-practice-2" target="_blank" rel="external">https://github.com/Ricardo-Li/node-practice-2</a> (这个项目已经被删了。参照 <a href="https://github.com/alsotang/node-lessons/tree/master/lesson3" target="_blank" rel="external">https://github.com/alsotang/node-lessons/tree/master/lesson3</a> 的代码自己操作一下吧。)这个项目部署上 heroku，成为一个线上项目</p><p>我部署的在这里 <a href="http://serene-falls-9294.herokuapp.com/" target="_blank" rel="external">http://serene-falls-9294.herokuapp.com/</a></p><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><ol><li>学习 heroku 的线上部署(<a href="https://www.heroku.com/" target="_blank" rel="external">https://www.heroku.com/</a> )</li></ol><h2 id="课程内容"><a href="#课程内容" class="headerlink" title="课程内容"></a>课程内容</h2><h3 id="什么是-heroku"><a href="#什么是-heroku" class="headerlink" title="什么是 heroku"></a>什么是 heroku</h3><p>heroku 是弄 ruby 的 paas 起家，现在支持多种语言环境，更甚的是它强大的 add-on 服务。</p><p>paas 平台相信大家都不陌生。Google 有 gae，国内新浪有 sae。paas 平台相对 vps 来说，不需要你配置服务器，不需要装数据库，也不需要理会负载均衡。这一切都可以在平台上直接获取。</p><p>你只要专注自己的业务，把应用的逻辑写好，然后发布上去，应用自然就上线了。数据库方面，如果你用 mysql，那么你可以从平台商那里得到一个 mysql 的地址、账号和密码，直接连接就能用。如果应用的流量增大，需要横向拓展，则只用去到 paas 平台的管理页面，增大服务器实例的数量即可，负载均衡会自动帮你完成。</p><p>说起来，我之所以对于 web 开发产生兴趣也是因为当年 gae 的关系。那时候除了 gae 之外，没有别的 paas 平台，gae 是横空出世的。有款翻墙的软件，叫 gappproxy(<a href="https://code.google.com/p/gappproxy/" target="_blank" rel="external">https://code.google.com/p/gappproxy/</a> )——可以认为是 goagent 的前身——就是搭建在 gae 上面的，不仅快，而且免费。于是我就很想弄懂这样一个程序是如何开发的。好在 gappproxy 是开源的，于是我下了源码来看，那时候才大一，只学过 c，看到那些 python 代码就凌乱了。于是转头也去学 python，后来渐渐发现了 web 开发的乐趣，于是 ruby 和 node.js 也碰碰。后来 goagent 火起来了，我又去看了看它的代码，发现非常难看，就自己写了个 <a href="https://github.com/alsotang/keepagent" target="_blank" rel="external">https://github.com/alsotang/keepagent</a> 。不过现在回想起来，还是 goagent 的实现比较稳定以及效率高。</p><p>heroku 的免费额度还是足够的，对于 demo 应用来说，放上去是绰绰有余的。各位搞 web 开发的大学生朋友，一定要试着让你开发的项目尽可能早地去线上跑，这样你的项目可以被其他人看到，能够促使你更有热情地进行进一步开发。这回我们放的是 cnode 社区的爬虫上去，你其实可以试着为你们学院或者学校的新闻站点写个爬虫，提供 json api，然后去申请个微信公共平台，每天推送学院网站的新闻。这东西辅导员是有需求的，可以做个给他们用。</p><p>好了，我们先 clone <a href="https://github.com/Ricardo-Li/node-practice-2" target="_blank" rel="external">https://github.com/Ricardo-Li/node-practice-2</a> 这个项目。由于我们这回讲部署，所以代码就用现成的了，代码的内容就是 lesson 3（<a href="https://github.com/alsotang/node-lessons/tree/master/lesson3" target="_blank" rel="external">https://github.com/alsotang/node-lessons/tree/master/lesson3</a> ） 里面的那个爬虫。</p><p><img src="https://github.com/alsotang/node-lessons/blob/master/lesson12/1.png" alt=""></p><p>clone 下来以后，我们去看看代码。代码中有两个特殊的地方，</p><p>一个是一个叫 Procfile 的文件，内容是：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">web: node app.js</span><br></pre></td></tr></table></figure><p>一个是 app.js 里面，</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.listen(process.env.PORT || <span class="number">5000</span>);</span><br></pre></td></tr></table></figure><p>这两者都是为了部署 heroku 所做的。</p><p>大家有没有想过，当部署一个应用上 paas 平台以后，paas 要为我们干些什么？</p><p>首先，平台要有我们语言的运行时；</p><p>然后，对于 node.js 来说，它要帮我们安装 package.json 里面的依赖；</p><p>然后呢？然后需要启动我们的项目；</p><p>然后把外界的流量导入我们的项目，让我们的项目提供服务。</p><p>上面那两处特殊的地方，一个是启动项目的，一个是导流量的。</p><p>heroku 虽然能推测出你的应用是 node.js 应用，但它不懂你的主程序是哪个，所以我们提供了 Procfile 来指导它启动我们的程序。</p><p>而我们的程序，本来是监听 5000 端口的，但是 heroku 并不知道。当然，你也可以在 Procfile 中告诉 heroku，可如果大家都监听 5000 端口，这时候不就有冲突了吗？所以这个地方，heroku 使用了主动的策略，主动提供一个环境变量 <code>process.env.PORT</code> 来供我们监听。</p><p>这样的话，一个简单 app 的配置就完成了。</p><p>我们去 <a href="https://www.heroku.com/" target="_blank" rel="external">https://www.heroku.com/</a> 申请个账号，然后下载它的工具包 <a href="https://toolbelt.heroku.com/" target="_blank" rel="external">https://toolbelt.heroku.com/</a> ，然后再在命令行里面，通过 <code>heroku login</code> 来登录。</p><p>上述步骤完成后，我们进入 <code>node-practice-2</code> 的目录，执行 <code>heroku create</code>。这时候，heroku 会为我们随机取一个应用名字，并提供一个 git 仓库给我们。</p><p><img src="https://github.com/alsotang/node-lessons/blob/master/lesson12/2.png" alt=""></p><p>接着，往 heroku 这个远端地址推送我们的 master 分支：</p><p><img src="https://github.com/alsotang/node-lessons/blob/master/lesson12/3.png" alt=""></p><p>heroku 会自动检测出我们是 node.js 程序，并安装依赖，然后按照 Procfile 进行启动。</p><p>push 完成后，在命令键入 <code>heroku open</code>，则 heroku 会自动打开浏览器带我们去到相应的网址：</p><p><img src="https://github.com/alsotang/node-lessons/blob/master/lesson12/4.png" alt=""></p><p>到此课程也就结束了。</p><p>随便聊聊 heroku 的 addon 吧。这个 addon 确实是个神奇的东西，反正在 heroku 之外我还没怎么见到这类概念。这些 addon 提供商，有些提供 redis 的服务，有些提供 mongodb，有些提供 mysql。你可以直接在 heroku 上面进行购买，然后 heroku 就会提供一段相应服务的地址和账号密码给你用来连接。</p><p>大家可以去 <a href="https://addons.heroku.com/" target="_blank" rel="external">https://addons.heroku.com/</a> 这个页面看看，玲琅满目各种应用可以方便接入。之所以这类服务有市场，也是因为亚马逊的 aws 非常牛逼。为什么这么说呢，因为网络速度啊。如果现在在国内，你在 ucloud 买个主机，然后用个阿里云的 rds，那么应用的响应速度会因为 mysql 连接的问题卡得动不了。但在 heroku 这里，提供商们，包括 heroku 自己，都是构建在 aws 上面，这样一来，各种服务的互通其实走的是内网，速度很可以接受，于是各种 addon 提供商就做起来了。</p><p>国内的话，其实在阿里云上面也可以考虑这么搞一搞。</p><p>完。</p></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="https://avatars1.githubusercontent.com/u/7907969" alt="落月"><p class="site-author-name" itemprop="name">落月</p><p class="site-description motion-element" itemprop="description">不知乘月几人归，落月摇情满江树。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/"><span class="site-state-item-count">0</span> <span class="site-state-item-name">日志</span></a></div></nav><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#《线上部署：heroku》"><span class="nav-number">1.</span> <span class="nav-text">《线上部署：heroku》</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标"><span class="nav-number">1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#知识点"><span class="nav-number">1.2.</span> <span class="nav-text">知识点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#课程内容"><span class="nav-number">1.3.</span> <span class="nav-text">课程内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是-heroku"><span class="nav-number">1.3.1.</span> <span class="nav-text">什么是 heroku</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright text-center">爱是一念之差，最幸福的不过是，你曾温柔呼唤，<br>而我恰好有过应答。</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/jquery/pjax.js?v=1.9.6"></script><script type="text/javascript" src="/vendors/jquery/nprogess.js?v=0.2.0"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/static/js/src/utils.js?v=1.0.1"></script><script type="text/javascript" src="/static/js/src/motion.js?v=1.0.1"></script><script type="text/javascript" src="/static/js/src/bootstrap.js?v=1.0.1"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),s=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!0,s=r.title.trim().toLowerCase(),n=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=r.url,i=-1,l=-1,p=-1;if(""!=s&&""!=n&&a.forEach(function(e,t){i=s.indexOf(e),l=n.indexOf(e),0>i&&0>l?c=!1:(0>l&&(l=0),0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+s+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;0>u&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),s.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").mousedown(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script></body></html><!-- rebuild by neat -->